<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Before I Choose You</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=UnifrakturMaguntia&family=Josefin+Sans:wght@100;200;300&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #080808;
            --border: #4a3820;
            --gold: #f0c84a;
            --gold-dim: #c49a3c;
            --red: #c0392b;
            --text: #f0e8d0;
            --text-dim: #b8a888;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            background: var(--bg);
            color: var(--text);
            font-family: 'Cormorant Garamond', serif;
            overflow-x: hidden;
        }

        /* Grain overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 9999;
            opacity: 0.5;
        }

        /* Vignette */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 40%, rgba(0, 0, 0, 0.85) 100%);
            pointer-events: none;
            z-index: 9998;
        }

        /* â”€â”€ PAGE SYSTEM â”€â”€ */
        .page {
            position: fixed;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1.2s ease;
            overflow-y: auto;
            z-index: 10;
        }

        .page.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Particle canvas */
        #particle-canvas {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 2;
            transition: opacity 2.5s ease;
        }

        #particle-canvas.dimmed {
            opacity: 0;
        }

        /* â”€â”€ HOME PAGE â”€â”€ */
        .home-eyebrow {
            font-family: 'Cormorant Garamond', serif;
            font-size: 0.75rem;
            letter-spacing: 0.4em;
            color: var(--gold-dim);
            text-transform: uppercase;
            margin-bottom: 1.5rem;
            animation: fadeUp 2s ease forwards;
        }

        .home-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(3rem, 8vw, 7rem);
            color: var(--gold);
            text-align: center;
            line-height: 1;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 60px rgba(240, 200, 74, 0.4), 0 0 120px rgba(240, 200, 74, 0.15);
            animation: fadeUp 2s ease 0.3s forwards;
            opacity: 0;
        }

        .home-subtitle {
            font-style: italic;
            font-size: 1rem;
            color: var(--text-dim);
            letter-spacing: 0.2em;
            margin-bottom: 4rem;
            animation: fadeUp 2s ease 0.6s forwards;
            opacity: 0;
        }

        .act-buttons {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            animation: fadeUp 2s ease 0.9s forwards;
            opacity: 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .act-btn {
            position: relative;
            background: rgba(240, 200, 74, 0.06);
            border: 1px solid var(--gold-dim);
            color: var(--gold);
            font-family: 'Josefin Sans', sans-serif;
            font-size: 0.75rem;
            letter-spacing: 0.2em;
            padding: 1.1rem 2rem;
            cursor: pointer;
            transition: all 0.5s ease;
            overflow: hidden;
            white-space: nowrap;
        }

        .act-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gold);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
            z-index: -1;
        }

        .act-btn:hover:not(.locked) {
            color: var(--bg);
            border-color: var(--gold);
            box-shadow: 0 0 40px rgba(240, 200, 74, 0.25);
        }

        .act-btn:hover:not(.locked)::before {
            transform: scaleX(1);
        }

        /* Locked button state */
        .act-btn.locked {
            border-color: #3a3020;
            color: #5a4a30;
            background: rgba(240, 200, 74, 0.02);
            cursor: not-allowed;
        }

        .act-btn.locked::after {
            content: 'ğŸ”’';
            font-size: 0.65rem;
            margin-left: 0.5rem;
            opacity: 0.6;
        }

        /* Completed button state */
        .act-btn.completed {
            border-color: var(--gold-dim);
            color: var(--gold-dim);
        }

        .act-btn.completed::after {
            content: ' âœ“';
            font-size: 0.65rem;
            opacity: 0.8;
        }

        .divider {
            width: 1px;
            height: 50px;
            background: linear-gradient(to bottom, transparent, var(--gold-dim), transparent);
            flex-shrink: 0;
        }

        /* â”€â”€ SECTION LABEL + TITLE â”€â”€ */
        .section-label {
            font-family: 'Josefin Sans', sans-serif;
            font-size: 0.62rem;
            font-weight: 100;
            letter-spacing: 0.55em;
            color: var(--gold-dim);
            text-transform: uppercase;
            margin-bottom: 0.6rem;
        }

        .section-title {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 100;
            font-size: clamp(1.5rem, 3.5vw, 2.8rem);
            letter-spacing: 0.2em;
            color: var(--gold);
            text-align: center;
            text-transform: uppercase;
            text-shadow: 0 0 40px rgba(240, 200, 74, 0.3);
            margin-bottom: 2.5rem;
        }

        /* â”€â”€ BACK BUTTON â”€â”€ */
        .back-btn {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            background: rgba(240, 200, 74, 0.05);
            border: 1px solid var(--gold-dim);
            color: var(--gold-dim);
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 200;
            font-size: 0.65rem;
            letter-spacing: 0.3em;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 200;
            display: none;
            text-transform: uppercase;
        }

        .back-btn:hover {
            color: var(--gold);
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(240, 200, 74, 0.2);
        }

        .back-btn.visible {
            display: block;
        }

        /* â”€â”€ FORM CONTAINERS â”€â”€ */
        .password-wrap,
        .act2-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            max-width: 460px;
            width: 100%;
        }

        .mystery-text {
            font-style: italic;
            color: var(--text-dim);
            text-align: center;
            font-size: 1.05rem;
            line-height: 1.9;
        }

        .question-text {
            text-align: center;
            font-size: 1.2rem;
            font-style: italic;
            color: var(--text);
            line-height: 1.7;
        }

        /* â”€â”€ INPUTS â”€â”€ */
        .pw-input,
        .answer-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--gold-dim);
            color: var(--gold);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.2rem;
            letter-spacing: 0.25em;
            padding: 0.8rem 1.2rem;
            text-align: center;
            outline: none;
            transition: all 0.3s ease;
        }

        .pw-input:focus,
        .answer-input:focus {
            border-color: var(--gold);
            box-shadow: 0 0 20px rgba(240, 200, 74, 0.15);
        }

        .pw-input::placeholder,
        .answer-input::placeholder {
            color: var(--text-dim);
            font-style: italic;
            letter-spacing: 0.15em;
        }

        .pw-error {
            color: #e05555;
            font-style: italic;
            font-size: 0.9rem;
            letter-spacing: 0.08em;
            opacity: 0;
            transition: opacity 0.3s;
            text-align: center;
        }

        .pw-error.show {
            opacity: 1;
        }

        /* â”€â”€ SUBMIT BUTTON â”€â”€ */
        .submit-btn {
            background: rgba(240, 200, 74, 0.06);
            border: 1px solid var(--gold-dim);
            color: var(--gold);
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 200;
            font-size: 0.62rem;
            letter-spacing: 0.38em;
            text-transform: uppercase;
            padding: 0.8rem 2.2rem;
            cursor: pointer;
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: var(--gold);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.35s ease;
            z-index: -1;
        }

        .submit-btn:hover {
            color: var(--bg);
            border-color: var(--gold);
        }

        .submit-btn:hover::before {
            transform: scaleX(1);
        }

        /* â”€â”€ VIDEO PAGES â”€â”€ */
        .video-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 820px;
        }

        .video-container {
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border: 1px solid var(--border);
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Transcript */
        .transcript-wrap {
            width: 100%;
        }

        .transcript-header {
            border: 1px solid var(--border);
            border-top: none;
            padding: 0.7rem 1.2rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: border-color 0.3s;
            background: rgba(255, 255, 255, 0.03);
        }

        .transcript-header:hover {
            border-color: var(--gold-dim);
        }

        .transcript-header span:first-child {
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 100;
            font-size: 0.6rem;
            letter-spacing: 0.42em;
            color: var(--gold-dim);
            text-transform: uppercase;
        }

        .transcript-toggle {
            color: var(--gold-dim);
            font-size: 1rem;
        }

        .transcript-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.6s ease;
            border: 1px solid var(--border);
            border-top: none;
            background: rgba(255, 255, 255, 0.02);
        }

        .transcript-body.open {
            max-height: 420px;
        }

        .transcript-inner {
            padding: 1.2rem;
        }

        .transcript-lang-tabs {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .lang-tab {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 200;
            font-size: 0.62rem;
            letter-spacing: 0.25em;
            text-transform: uppercase;
            padding: 0.3rem 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .lang-tab.active {
            border-color: var(--gold-dim);
            color: var(--gold);
        }

        .transcript-text {
            font-style: italic;
            line-height: 1.9;
            color: var(--text-dim);
            font-size: 0.95rem;
            display: none;
            overflow-y: auto;
            max-height: 280px;
        }

        .transcript-text.active {
            display: block;
        }

        /* â”€â”€ PROGRESS DOTS â”€â”€ */
        .progress-dots {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #3a3020;
            transition: background 0.4s;
        }

        .dot.done {
            background: var(--gold-dim);
        }

        .dot.current {
            background: var(--gold);
        }

        /* â”€â”€ BUDGET FORM â”€â”€ */
        .budget-form {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .budget-row {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .budget-label {
            flex: 1;
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 100;
            font-size: 0.62rem;
            letter-spacing: 0.3em;
            color: var(--text-dim);
            text-transform: uppercase;
        }

        .budget-input {
            width: 80px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--gold-dim);
            color: var(--gold);
            font-family: 'Cormorant Garamond', serif;
            font-size: 1rem;
            padding: 0.5rem 0.6rem;
            outline: none;
            text-align: center;
            transition: border-color 0.3s;
        }

        .budget-input:focus {
            border-color: var(--gold);
        }

        .budget-pct {
            color: var(--gold-dim);
            font-size: 0.9rem;
        }

        .budget-total {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-dim);
            font-style: italic;
        }

        .budget-total.valid {
            color: var(--gold-dim);
        }

        .budget-total.invalid {
            color: #e05555;
        }

        .budget-total.leisure-warning {
            color: #d4943a;
            font-style: italic;
        }

        /* â”€â”€ ACT III FINALE â”€â”€ */
        .finale-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
            max-width: 520px;
            text-align: center;
        }

        .finale-door {
            font-size: clamp(4rem, 12vw, 8rem);
            line-height: 1;
            animation: pulseGlow 3s ease-in-out infinite;
        }

        @keyframes pulseGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 20px rgba(240, 200, 74, 0.3));
            }

            50% {
                filter: drop-shadow(0 0 60px rgba(240, 200, 74, 0.8));
            }
        }

        .finale-message {
            font-size: 1.25rem;
            font-style: italic;
            color: var(--text);
            line-height: 1.9;
        }

        .finale-sub {
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 100;
            font-size: 0.62rem;
            letter-spacing: 0.5em;
            color: var(--gold-dim);
            text-transform: uppercase;
        }

        /* â”€â”€ ORNAMENT LINE â”€â”€ */
        .ornament {
            display: flex;
            align-items: center;
            gap: 1rem;
            width: 100%;
            max-width: 360px;
            color: var(--gold-dim);
            font-size: 0.6rem;
        }

        .ornament::before,
        .ornament::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* â”€â”€ ANIMATIONS â”€â”€ */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(18px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        ::-webkit-scrollbar {
            width: 3px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold-dim);
        }

        /* â”€â”€ POST-VIDEO PROMPT â”€â”€ */
        .post-video-prompt {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.2rem;
            margin-top: 1.8rem;
            padding: 1.6rem 2rem;
            border: 1px solid var(--border);
            background: rgba(240, 200, 74, 0.03);
            width: 100%;
            animation: fadeUp 1s ease 0.3s both;
        }

        .post-video-text {
            font-family: 'Cormorant Garamond', serif;
            font-style: italic;
            font-size: 1rem;
            color: var(--text-dim);
            line-height: 1.85;
            text-align: center;
        }

        /* â”€â”€ LOCKED TOOLTIP â”€â”€ */
        .act-btn-wrap {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .lock-hint {
            position: absolute;
            top: calc(100% + 0.4rem);
            font-family: 'Josefin Sans', sans-serif;
            font-weight: 100;
            font-size: 0.52rem;
            letter-spacing: 0.2em;
            color: #4a3820;
            text-transform: uppercase;
            text-align: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            white-space: nowrap;
        }
    </style>
</head>

<body>

    <canvas id="particle-canvas"></canvas>
    <button class="back-btn" id="backBtn" onclick="goHome()">â† Return</button>

    <!-- HOME -->
    <div class="page active" id="page-home">
        <div class="home-eyebrow">A Mystery in Three Acts</div>
        <h1 class="home-title">Before I Choose You</h1>
        <p class="home-subtitle">Seek the truth between the walls</p>
        <div class="act-buttons">
            <div class="act-btn-wrap">
                <button class="act-btn" id="btn-act1" onclick="navigate('page-act1-password')">Act I</button>
            </div>
            <div class="divider"></div>
            <div class="act-btn-wrap">
                <button class="act-btn locked" id="btn-act2" onclick="tryAct2()">Act II</button>
                <span class="lock-hint" id="hint-act2">Complete Act I first</span>
            </div>
            <div class="divider"></div>
            <div class="act-btn-wrap">
                <button class="act-btn locked" id="btn-act3" onclick="tryAct3()">Act III</button>
                <span class="lock-hint" id="hint-act3">Complete Act II first</span>
            </div>
        </div>
    </div>

    <!-- ACT I â€” PASSWORD -->
    <div class="page" id="page-act1-password">
        <div class="section-label">Act I</div>
        <h2 class="section-title">Identify the Suspect</h2>
        <div class="password-wrap">
            <p class="mystery-text">
                A photograph lies before you â€” incomplete.<br>
                Somewhere in its fragments hides the suspect.<br><br>
                To reveal them, speak the name of the place<br>where it all began.
            </p>
            <div class="ornament">âœ¦</div>
            <input class="pw-input" id="pw-input" placeholder="Where was the photo taken..."
                onkeydown="if(event.key==='Enter')checkPassword()">
            <p class="pw-error" id="pw-error">Hint: Where was the photo taken? It has a boardwalk...</p>
            <button class="submit-btn" onclick="checkPassword()">Unlock</button>
        </div>
    </div>

    <!-- ACT I â€” VIDEO -->
    <div class="page" id="page-act1-video">
        <div class="section-label">Act I</div>
        <h2 class="section-title">Against All Odds</h2>
        <div class="video-wrap">
            <div class="video-container">
                <iframe id="act1-iframe" src="" allowfullscreen></iframe>
            </div>
            <div class="transcript-wrap">
                <div class="transcript-header" onclick="toggleTranscript('t1')">
                    <span>View Transcript</span>
                    <span class="transcript-toggle" id="t1-icon">â–¾</span>
                </div>
                <div class="transcript-body" id="t1-body">
                    <div class="transcript-inner">
                        <div class="transcript-lang-tabs">
                            <button class="lang-tab active" onclick="setLang('t1','en',this)">English</button>
                            <button class="lang-tab" onclick="setLang('t1','zh',this)">ä¸­æ–‡</button>
                        </div>
                        <div class="transcript-text active" id="t1-en">
                            Dear Koko,

                            <br><br>

                            It's somewhat of a miracle that we're together.
                            If you think about it, the odds aren't exactly obvious.

                            <br><br>

                            I'm a Chinese-American boy fresh out of a breakup
                            who turned to badminton to piece myself back together.

                            <br><br>

                            You had a stable life in China,
                            but decided to uproot yourself and start a new career in the Bay Area.

                            <br><br>

                            Kevin just happened to be at the gym without a partner on the day he met me,
                            starting our badminton group.

                            <br><br>

                            Kiko ran into you and Pia in your apartment hallway
                            and invited you to play with us.

                            <br><br>

                            That's a lot of random events lining up.

                            <br><br>

                            We spoke different languages,
                            grew up differently,
                            and were at completely different points in life.

                            <br><br>

                            And yet, three years later, we're still here.

                            <br><br>

                            While others drifted in and out of our lives,
                            we're still together.

                            Not because it was easy,
                            but because we chose to do so.

                            <br><br>

                            From the beginning, we leaned into what we shared:
                            games, bad puns, logic puzzles.

                            <br><br>

                            We explored new activities together:
                            roller skating, tennis, fishing, uni foraging, and the arcade.

                            <br><br>

                            We traveled across the US from the Pacific Northwest to the Everglades,
                            to China and back.

                            <br><br>

                            While meeting might have been luck,
                            staying together hasn't been.

                            <br><br>

                            It's taken effort,
                            and a good fit.
                        </div>
                        <div class="transcript-text" id="t1-zh">
                            äº²çˆ±çš„ Kokoï¼š

                            <br><br>

                            æˆ‘ä»¬èƒ½èµ°åˆ°ä¸€èµ·ï¼ŒæŸç§ç¨‹åº¦ä¸ŠçœŸçš„åƒä¸ªå¥‡è¿¹ã€‚
                            ä»”ç»†æƒ³æƒ³ï¼Œè¿™å…¶ä¸­çš„æ¦‚ç‡å¹¶ä¸é‚£ä¹ˆæ˜¾è€Œæ˜“è§ã€‚

                            <br><br>

                            æˆ‘æ˜¯ä¸€ä¸ªåˆšç»å†åˆ†æ‰‹çš„åè£”ç”·ç”Ÿï¼Œ
                            é æ‰“ç¾½æ¯›çƒæ…¢æ…¢æŠŠè‡ªå·±æ‹¼å‡‘å›æ¥ã€‚

                            <br><br>

                            è€Œä½ ï¼Œåœ¨ä¸­å›½åŸæœ¬æœ‰ç€ç¨³å®šçš„ç”Ÿæ´»ï¼Œ
                            å´é€‰æ‹©ç¦»å¼€ä¸€åˆ‡ï¼Œåˆ°æ¹¾åŒºå¼€å¯å…¨æ–°çš„èŒä¸šé“è·¯ã€‚

                            <br><br>

                            Kevin åååœ¨é‚£å¤©åœ¨çƒé¦†æ²¡æœ‰æ­æ¡£ï¼Œ
                            äºæ˜¯è®¤è¯†äº†æˆ‘ï¼Œå¼€å§‹äº†æˆ‘ä»¬çš„ç¾½æ¯›çƒå°ç»„ã€‚

                            <br><br>

                            Kiko åˆåˆšå¥½åœ¨ä½ ä»¬å…¬å¯“èµ°å»Šé‡Œé‡è§ä½ å’Œ Piaï¼Œ
                            é‚€è¯·ä½ æ¥å’Œæˆ‘ä»¬ä¸€èµ·æ‰“çƒã€‚

                            <br><br>

                            è¿™ä¹ˆå¤šçœ‹ä¼¼éšæœºçš„äº‹æƒ…ï¼Œæ°å¥½ä¸€ä¸€å¯¹é½ã€‚

                            <br><br>

                            æˆ‘ä»¬è¯´ç€ä¸åŒçš„è¯­è¨€ï¼Œ
                            åœ¨ä¸åŒçš„ç¯å¢ƒä¸­é•¿å¤§ï¼Œ
                            ä¹Ÿå¤„åœ¨äººç”Ÿå®Œå…¨ä¸åŒçš„é˜¶æ®µã€‚

                            <br><br>

                            å¯ä¸‰å¹´åçš„ä»Šå¤©ï¼Œæˆ‘ä»¬ä¾ç„¶åœ¨è¿™é‡Œã€‚

                            <br><br>

                            åˆ«äººæ¥æ¥å»å»ï¼Œè€Œæˆ‘ä»¬è¿˜åœ¨ä¸€èµ·ã€‚
                            ä¸æ˜¯å› ä¸ºä¸€åˆ‡éƒ½å¾ˆå®¹æ˜“ï¼Œ
                            è€Œæ˜¯å› ä¸ºæˆ‘ä»¬é€‰æ‹©äº†å½¼æ­¤ã€‚

                            <br><br>

                            ä»ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å°±æŠ•å…¥åœ¨æˆ‘ä»¬å…±åŒçƒ­çˆ±çš„äº‹ç‰©é‡Œï¼š
                            æ¸¸æˆã€å†·ç¬‘è¯ã€é€»è¾‘è°œé¢˜ã€‚

                            <br><br>

                            æˆ‘ä»¬ä¸€èµ·å°è¯•æ–°çš„æ´»åŠ¨ï¼š
                            æ»‘è½®æ»‘ã€ç½‘çƒã€é’“é±¼ã€èµ¶æµ·æ¡æµ·èƒ†ã€è¿˜æœ‰å»æ¸¸æˆå…ã€‚

                            <br><br>

                            æˆ‘ä»¬ä¸€èµ·æ—…è¡Œï¼Œ
                            ä»ç¾å›½è¥¿åŒ—éƒ¨åˆ°ä½›ç½—é‡Œè¾¾å¤§æ²¼æ³½åœ°ï¼Œ
                            åˆå¾€è¿”ä¸­å›½ã€‚

                            <br><br>

                            ä¹Ÿè®¸ç›¸é‡æ˜¯å¹¸è¿ï¼Œ
                            ä½†èƒ½å¤Ÿä¸€ç›´èµ°åˆ°ç°åœ¨å¹¶ä¸æ˜¯ã€‚

                            <br><br>

                            å®ƒéœ€è¦åŠªåŠ›ï¼Œ
                            ä¹Ÿéœ€è¦å½¼æ­¤å¥‘åˆã€‚
                        </div>
                    </div>
                </div>
            </div>
            <!-- Post-video prompt -->
            <div class="post-video-prompt">
                <div class="ornament">âœ¦</div>
                <p class="post-video-text">
                    The suspect seems to be Michael! When you're ready, grab the latex gloves hidden inside the stove,
                    and proceed into the master bedroom. It's time to see who the victims are, and save them before it's
                    too late.
                </p>
                <button class="submit-btn" onclick="navigate('page-act2-q1')">Proceed to Act II â†’</button>
            </div>
        </div>
    </div>

    <!-- ACT II â€” Q1 -->
    <div class="page" id="page-act2-q1">
        <div class="section-label">Act II Â· Save the Victims</div>
        <h2 class="section-title">Question I</h2>
        <div class="progress-dots">
            <div class="dot current"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
        <div class="act2-wrap">
            <p class="question-text">How many cubes were there in the Big Brain Academy game?</p>
            <div class="ornament">âœ¦</div>
            <input class="answer-input" id="q1-input" type="number" placeholder="Enter a number..."
                onkeydown="if(event.key==='Enter')checkQ1()">
            <p class="pw-error" id="q1-error">Hint: It's 20...minus 1...</p>
            <button class="submit-btn" onclick="checkQ1()">Confirm</button>
        </div>
    </div>

    <!-- ACT II â€” Q2 -->
    <div class="page" id="page-act2-q2">
        <div class="section-label">Act II Â· Save the Victims</div>
        <h2 class="section-title">Question II</h2>
        <div class="progress-dots">
            <div class="dot done"></div>
            <div class="dot current"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
        <div class="act2-wrap">
            <p class="question-text">What is your spending budget allocation?<br><em
                    style="font-size:0.85rem;color:var(--text-dim)">The three dimensions must sum to 100%</em></p>
            <div class="ornament">âœ¦</div>
            <div class="budget-form">
                <div class="budget-row">
                    <span class="budget-label">Fixed Costs</span>
                    <input class="budget-input" id="b-fixed" type="number" min="0" max="100" value="0"
                        oninput="updateBudgetTotal()">
                    <span class="budget-pct">%</span>
                </div>
                <div class="budget-row">
                    <span class="budget-label">Savings</span>
                    <input class="budget-input" id="b-savings" type="number" min="0" max="100" value="0"
                        oninput="updateBudgetTotal()">
                    <span class="budget-pct">%</span>
                </div>
                <div class="budget-row">
                    <span class="budget-label">Leisure</span>
                    <input class="budget-input" id="b-leisure" type="number" min="0" max="100" value="0"
                        oninput="updateBudgetTotal()">
                    <span class="budget-pct">%</span>
                </div>
                <div class="budget-total" id="budget-total">Total: 0%</div>
            </div>
            <p class="pw-error" id="q2-error">The allocation must total 100â€¦</p>
            <button class="submit-btn" onclick="checkQ2()">Confirm</button>
        </div>
    </div>

    <!-- ACT II â€” Q3 -->
    <div class="page" id="page-act2-q3">
        <div class="section-label">Act II Â· Save the Victims</div>
        <h2 class="section-title">Question III</h2>
        <div class="progress-dots">
            <div class="dot done"></div>
            <div class="dot done"></div>
            <div class="dot current"></div>
            <div class="dot"></div>
        </div>
        <div class="act2-wrap">
            <p class="question-text">What should we eat to cure health problems?</p>
            <div class="ornament">âœ¦</div>
            <input class="answer-input" id="q3-input" type="text" placeholder="Enter the foodâ€¦"
                onkeydown="if(event.key==='Enter')checkQ3()">
            <p class="pw-error" id="q3-error">Think "healthy"...</p>
            <button class="submit-btn" onclick="checkQ3()">Confirm</button>
        </div>
    </div>

    <!-- ACT II â€” Q4 -->
    <div class="page" id="page-act2-q4">
        <div class="section-label">Act II Â· Save the Victims</div>
        <h2 class="section-title">Question IV</h2>
        <div class="progress-dots">
            <div class="dot done"></div>
            <div class="dot done"></div>
            <div class="dot done"></div>
            <div class="dot current"></div>
        </div>
        <div class="act2-wrap">
            <p class="question-text">What is the cure for doubts and insecurities?</p>
            <div class="ornament">âœ¦</div>
            <input class="answer-input" id="q4-input" type="text" placeholder="your answerâ€¦"
                onkeydown="if(event.key==='Enter')checkQ4()">
            <p class="pw-error" id="q4-error">Look for the needle in the plushie haystackâ€¦</p>
            <button class="submit-btn" onclick="checkQ4()">Confirm</button>
        </div>
    </div>

    <!-- ACT II â€” VIDEO -->
    <div class="page" id="page-act2-video">
        <div class="section-label">Act II</div>
        <h2 class="section-title">Through Every Storm</h2>
        <div class="video-wrap">
            <div class="video-container">
                <iframe id="act2-iframe" src="" allowfullscreen></iframe>
            </div>
            <div class="transcript-wrap">
                <div class="transcript-header" onclick="toggleTranscript('t2')">
                    <span>View Transcript</span>
                    <span class="transcript-toggle" id="t2-icon">â–¾</span>
                </div>
                <div class="transcript-body" id="t2-body">
                    <div class="transcript-inner">
                        <div class="transcript-lang-tabs">
                            <button class="lang-tab active" onclick="setLang('t2','en',this)">English</button>
                            <button class="lang-tab" onclick="setLang('t2','zh',this)">ä¸­æ–‡</button>
                        </div>
                        <div class="transcript-text active" id="t2-en">
                            Thank you for choosing meâ€”and for continuing to choose meâ€”over these past three years.

                            <br><br>

                            When we first met, I was uncertain whether I was truly ready for another relationship.

                            <br><br>

                            That uncertainty made me hesitant, and at times, I did not treat you with the steadiness you
                            deserved.

                            <br><br>

                            Yet you met my inconsistency with patience.

                            <br><br>

                            You gave me space when I needed time to rediscover myself, and when I was finally ready to
                            commit, you welcomed me
                            without resentmentâ€”only warmth.

                            <br><br>

                            Over the years, my body has had its own challenges: sprained ankles, blood pressure
                            anxieties, seasonal flus that
                            overstayed their welcome.

                            <br><br>

                            And each time, without hesitation, you stood beside me.

                            <br><br>

                            You accompanied me to appointments, reassured me when my thoughts spiraled, and once even
                            pushed me through China in a
                            wheelchairâ€”never once complaining.

                            <br><br>

                            Your care has never been loud, but it has always been unwavering.

                            <br><br>

                            The biggest challenge for both of us continues to be work life balance.

                            <br><br>

                            Despite our demanding jobs, we have learned to reclaim a small amount of structure for
                            ourselvesâ€”decompressing at the
                            arcade and playing games, tending to the cats, or simply walking side by side in downtown
                            Sunnyvale.

                            <br><br>

                            In those quiet rituals, we find our way back to each other.

                            <br><br>

                            Koko, you are remarkably strong.

                            <br><br>

                            Through my waveringâ€”my doubts, my stress, my anxietiesâ€”you have been the constant.

                            <br><br>

                            Steady.

                            <br><br>

                            Grounded.

                            <br><br>

                            Resolute.

                            <br><br>

                            You have not merely endured the turbulence; you have helped steer us through it.

                            <br><br>

                            Being part of your life has been one of the great privileges of mine.

                            <br><br>

                            And I hope that I may remain by your side for many years to come.

                            <br><br>

                            The only question that remains is this:

                            <br><br>

                            Do you want the same?
                        </div>
                        <div class="transcript-text" id="t2-zh">
                            æ„Ÿè°¢ä½ é€‰æ‹©æˆ‘â€”â€”ä¹Ÿæ„Ÿè°¢ä½ åœ¨è¿‡å»ä¸‰å¹´é‡Œï¼Œä¸€æ¬¡åˆä¸€æ¬¡åœ°ç»§ç»­é€‰æ‹©æˆ‘ã€‚

                            <br><br>

                            å½“æˆ‘ä»¬åˆšè®¤è¯†çš„æ—¶å€™ï¼Œæˆ‘å¹¶ä¸ç¡®å®šè‡ªå·±æ˜¯å¦çœŸçš„å‡†å¤‡å¥½è¿›å…¥å¦ä¸€æ®µæ„Ÿæƒ…ã€‚

                            <br><br>

                            è¿™ç§ä¸ç¡®å®šè®©æˆ‘æœ‰æ‰€è¿Ÿç–‘ï¼Œä¹Ÿæ›¾åœ¨ä¸€äº›æ—¶åˆ»ï¼Œæ²¡æœ‰ç»™äºˆä½ åº”å¾—çš„åšå®šä¸å®‰å¿ƒã€‚

                            <br><br>

                            è€Œä½ å´ç”¨è€å¿ƒå›åº”äº†æˆ‘çš„æ‘‡æ‘†ã€‚

                            <br><br>

                            å½“æˆ‘éœ€è¦æ—¶é—´é‡æ–°æ‰¾å›è‡ªå·±æ—¶ï¼Œä½ ç»™äº†æˆ‘ç©ºé—´ï¼›å½“æˆ‘ç»ˆäºå‡†å¤‡å¥½çœŸæ­£æŠ•å…¥æ—¶ï¼Œä½ æ²¡æœ‰æ€¨æ€¼ï¼Œåªæœ‰æ¸©æŸ”åœ°æ¥çº³ã€‚

                            <br><br>

                            è¿™äº›å¹´é‡Œï¼Œæˆ‘çš„èº«ä½“ä¹Ÿç»å†äº†ä¸å°‘æŒ‘æˆ˜ï¼šæ‰­ä¼¤çš„è„šè¸ã€å¯¹è¡€å‹çš„ç„¦è™‘ã€è¿Ÿè¿Ÿä¸è‚¯ç¦»å»çš„å­£èŠ‚æ€§æ„Ÿå†’ã€‚

                            <br><br>

                            è€Œæ¯ä¸€æ¬¡ï¼Œä½ éƒ½æ¯«ä¸çŠ¹è±«åœ°ç«™åœ¨æˆ‘èº«æ—ã€‚

                            <br><br>

                            ä½ é™ªæˆ‘å»çœ‹åŒ»ç”Ÿï¼Œåœ¨æˆ‘æ€ç»ªå¤±æ§æ—¶å®‰æŠšæˆ‘ï¼Œç”šè‡³æœ‰ä¸€æ¬¡åœ¨ä¸­å›½æ¨ç€ååœ¨è½®æ¤…ä¸Šçš„æˆ‘èµ°è¿‡è¡—å··â€”â€”ä»æœªæŠ±æ€¨ä¸€å¥ã€‚

                            <br><br>

                            ä½ çš„å…³å¿ƒä»ä¸å¼ æ‰¬ï¼Œå´å§‹ç»ˆåšå®šã€‚

                            <br><br>

                            å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œæœ€å¤§çš„æŒ‘æˆ˜æˆ–è®¸ä»ç„¶æ˜¯å·¥ä½œä¸ç”Ÿæ´»çš„å¹³è¡¡ã€‚

                            <br><br>

                            å°½ç®¡å·¥ä½œç¹å¿™ï¼Œæˆ‘ä»¬è¿˜æ˜¯å­¦ä¼šä¸ºå½¼æ­¤ç•™å‡ºä¸€ç‚¹ç§©åºâ€”â€”åœ¨æ¸¸æˆå…æ”¾æ¾æ‰“æ¸¸æˆï¼Œç…§é¡¾çŒ«å’ªï¼Œæˆ–è€…åªæ˜¯å¹¶è‚©èµ°åœ¨Sunnyvaleçš„å¸‚ä¸­å¿ƒã€‚

                            <br><br>

                            åœ¨è¿™äº›å®‰é™çš„å°ä»ªå¼é‡Œï¼Œæˆ‘ä»¬æ€»èƒ½é‡æ–°æ‰¾åˆ°å½¼æ­¤ã€‚

                            <br><br>

                            Kokoï¼Œä½ çœŸçš„å¾ˆåšå¼ºã€‚

                            <br><br>

                            åœ¨æˆ‘çš„æ‘‡æ‘†â€”â€”æˆ‘çš„æ€€ç–‘ã€å‹åŠ›ä¸ç„¦è™‘â€”â€”ä¹‹ä¸­ï¼Œä½ å§‹ç»ˆæ˜¯é‚£ä¸ªä¸å˜çš„å­˜åœ¨ã€‚

                            <br><br>

                            åšå®šã€‚

                            <br><br>

                            æ²‰ç¨³ã€‚

                            <br><br>

                            æœå†³ã€‚

                            <br><br>

                            ä½ ä¸ä»…æ‰¿å—äº†é£æµªï¼Œæ›´é™ªæˆ‘ä¸€èµ·æŒèˆµå‰è¡Œã€‚

                            <br><br>

                            èƒ½å¤Ÿæˆä¸ºä½ ç”Ÿå‘½çš„ä¸€éƒ¨åˆ†ï¼Œæ˜¯æˆ‘äººç”Ÿä¸­è«å¤§çš„è£å¹¸ã€‚

                            <br><br>

                            ä¹Ÿå¸Œæœ›åœ¨æœªæ¥è®¸å¤šå¹´é‡Œï¼Œæˆ‘éƒ½èƒ½ç»§ç»­ç«™åœ¨ä½ èº«æ—ã€‚

                            <br><br>

                            å¦‚ä»Šï¼Œåªå‰©ä¸‹ä¸€ä¸ªé—®é¢˜ï¼š

                            <br><br>

                            ä½ æ„¿æ„å’Œæˆ‘ä¸€æ ·å—ï¼Ÿ
                        </div>
                    </div>
                </div>
            </div>
            <!-- Post-video prompt -->
            <div class="post-video-prompt">
                <div class="ornament">âœ¦</div>
                <p class="post-video-text">
                    You've saved the victims. It's time to find Michael to figure out his motives. Before you go, check
                    the closets, you may find the key to the final room.
                </p>
                <button class="submit-btn" onclick="navigate('page-act3-q1')">Proceed to Act III â†’</button>
            </div>
        </div>
    </div>

    <!-- ACT III â€” Q1 -->
    <div class="page" id="page-act3-q1">
        <div class="section-label">Act III</div>
        <h2 class="section-title">Find the Suspect</h2>
        <div class="act2-wrap">
            <p class="question-text">
                You've identified Michael as the suspect.<br>
                You saved the victims from their doubts and insecurities.<br><br>
                <em>It's now time to find him. What's the secret password?</em>
            </p>
            <div class="ornament">âœ¦</div>
            <input class="answer-input" id="q5-input" type="text" placeholder="Secret passwordâ€¦"
                onkeydown="if(event.key==='Enter')checkQ5()">
            <p class="pw-error" id="q5-error">Check in the box...</p>
            <button class="submit-btn" onclick="checkQ5()">Reveal</button>
        </div>
    </div>

    <!-- ACT III â€” FINALE -->
    <div class="page" id="page-act3-finale">
        <div class="section-label">Act III Â· Case Closed</div>
        <h2 class="section-title">Find the Suspect</h2>
        <div class="finale-wrap">
            <div class="finale-door">ğŸšª</div>
            <p class="finale-message">
                The mystery has been solved.<br>
                You may now open the final door. <br>
            </p>
            <div class="ornament">âœ¦</div>
            <p class="finale-sub">The truth was always here</p>
        </div>
    </div>

    <script>
        const ACT1_VIDEO = 'https://www.youtube.com/embed/fL9YZWjp0SY?si=0G7Z5zVboJOnSQfe&enablejsapi=1';
        const ACT2_VIDEO = 'https://www.youtube.com/embed/dFQBkrclUNA?si=wZHzAThTPzrtlJ1J&enablejsapi=1';
        const PASSWORD = 'Santa Cruz';

        // â”€â”€ COMPLETION STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const completed = { act1: false, act2: false };

        function unlockAct2() {
            if (completed.act1) return;
            completed.act1 = true;
            const btn = document.getElementById('btn-act2');
            const hint = document.getElementById('hint-act2');
            btn.classList.remove('locked');
            hint.style.opacity = '0';
            hint.style.pointerEvents = 'none';
            // Brief flash to draw attention
            btn.style.transition = 'box-shadow 0.6s ease';
            btn.style.boxShadow = '0 0 30px rgba(240,200,74,0.5)';
            setTimeout(() => { btn.style.boxShadow = ''; }, 1200);
        }

        function unlockAct3() {
            if (completed.act2) return;
            completed.act2 = true;
            const btn = document.getElementById('btn-act3');
            const hint = document.getElementById('hint-act3');
            btn.classList.remove('locked');
            hint.style.opacity = '0';
            hint.style.pointerEvents = 'none';
            btn.style.transition = 'box-shadow 0.6s ease';
            btn.style.boxShadow = '0 0 30px rgba(240,200,74,0.5)';
            setTimeout(() => { btn.style.boxShadow = ''; }, 1200);
        }

        function tryAct2() {
            if (!completed.act1) {
                // Shake the button to indicate it's locked
                const btn = document.getElementById('btn-act2');
                btn.style.animation = 'none';
                btn.style.transform = 'translateX(-4px)';
                setTimeout(() => { btn.style.transform = 'translateX(4px)'; }, 80);
                setTimeout(() => { btn.style.transform = 'translateX(-3px)'; }, 160);
                setTimeout(() => { btn.style.transform = 'translateX(3px)'; }, 240);
                setTimeout(() => { btn.style.transform = 'translateX(0)'; }, 320);
                // Show hint
                const hint = document.getElementById('hint-act2');
                hint.style.opacity = '1';
                setTimeout(() => { hint.style.opacity = ''; }, 2000);
                return;
            }
            navigate('page-act2-q1');
        }

        function tryAct3() {
            if (!completed.act2) {
                const btn = document.getElementById('btn-act3');
                btn.style.transform = 'translateX(-4px)';
                setTimeout(() => { btn.style.transform = 'translateX(4px)'; }, 80);
                setTimeout(() => { btn.style.transform = 'translateX(-3px)'; }, 160);
                setTimeout(() => { btn.style.transform = 'translateX(3px)'; }, 240);
                setTimeout(() => { btn.style.transform = 'translateX(0)'; }, 320);
                const hint = document.getElementById('hint-act3');
                hint.style.opacity = '1';
                setTimeout(() => { hint.style.opacity = ''; }, 2000);
                return;
            }
            navigate('page-act3-q1');
        }

        // â”€â”€ PARTICLE SYSTEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');

        const isMobile = window.innerWidth < 768;

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resize();
        window.addEventListener('resize', resize);

        const particles = [];
        let emberCount = 0, steamCount = 0;

        const EMBER_COLORS = ['#c9a84c', '#e8c96a', '#a07030', '#f0d080', '#8b5e20'];
        const STEAM_COLORS = ['rgba(180,160,100', 'rgba(120,100,60', 'rgba(200,180,120'];

        const MAX_EMBERS = isMobile ? 28 : 70;
        const MAX_STEAM = isMobile ? 8 : 20;
        const EMBER_INTERVAL = isMobile ? 180 : 90;
        const STEAM_INTERVAL = isMobile ? 500 : 240;
        const TRAIL_MAX = isMobile ? 6 : 18;

        function spawnEmber() {
            emberCount++;
            particles.push({
                type: 'ember',
                x: Math.random() * canvas.width,
                y: canvas.height + 10,
                vx: (Math.random() - 0.5) * 0.6,
                vy: -(0.5 + Math.random() * 1.4),
                size: 1 + Math.random() * 2.5,
                color: EMBER_COLORS[Math.floor(Math.random() * EMBER_COLORS.length)],
                alpha: 0, maxAlpha: 0.5 + Math.random() * 0.5,
                life: 0, maxLife: 200 + Math.random() * 350,
                flicker: Math.random() * Math.PI * 2,
                flickerSpeed: 0.05 + Math.random() * 0.07,
                trail: [], trailLen: Math.floor(4 + Math.random() * TRAIL_MAX),
            });
        }

        function spawnSteamPuff() {
            steamCount++;
            const base = STEAM_COLORS[Math.floor(Math.random() * STEAM_COLORS.length)];
            particles.push({
                type: 'steam',
                x: Math.random() * canvas.width,
                y: canvas.height * (0.5 + Math.random() * 0.5),
                vx: (Math.random() - 0.5) * 0.4,
                vy: -(0.3 + Math.random() * 0.7),
                size: 8 + Math.random() * 18,
                growRate: 0.08 + Math.random() * 0.12,
                color: base,
                alpha: 0, maxAlpha: 0.07 + Math.random() * 0.1,
                life: 0, maxLife: 300 + Math.random() * 500,
            });
        }

        let lastEmberTime = 0, lastSteamTime = 0;
        const TARGET_MS = isMobile ? 33 : 16;
        let lastFrameTime = 0;

        function updateParticles(ts) {
            if (ts - lastEmberTime > EMBER_INTERVAL && emberCount < MAX_EMBERS) {
                spawnEmber(); lastEmberTime = ts;
            }
            if (ts - lastSteamTime > STEAM_INTERVAL && steamCount < MAX_STEAM) {
                spawnSteamPuff(); lastSteamTime = ts;
            }

            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.life++;
                const fadeIn = Math.min(p.life / 40, 1);
                const fadeOut = 1 - Math.max((p.life - p.maxLife * 0.7) / (p.maxLife * 0.3), 0);

                if (p.type === 'ember') {
                    p.flicker += p.flickerSpeed;
                    p.vx += Math.sin(p.flicker) * 0.008;
                    p.x += p.vx; p.y += p.vy;
                    p.alpha = p.maxAlpha * fadeIn * fadeOut * (0.85 + 0.15 * Math.sin(p.flicker * 3));

                    p.trail.push({ x: p.x, y: p.y, alpha: p.alpha });
                    if (p.trail.length > p.trailLen) p.trail.shift();

                    for (let t = 0; t < p.trail.length; t++) {
                        const tp = p.trail[t], tf = t / p.trail.length;
                        const tr = p.size * (0.3 + tf * 0.7) * (1 + tf * 3);
                        const sg = ctx.createRadialGradient(tp.x, tp.y, 0, tp.x, tp.y, tr * 2.5);
                        sg.addColorStop(0, `rgba(160,130,60,${tp.alpha * tf * 0.35})`);
                        sg.addColorStop(0.4, `rgba(100,80,30,${tp.alpha * tf * 0.12})`);
                        sg.addColorStop(1, `rgba(60,40,10,0)`);
                        ctx.beginPath(); ctx.arc(tp.x, tp.y, tr * 2.5, 0, Math.PI * 2);
                        ctx.fillStyle = sg; ctx.fill();
                    }

                    if (!isMobile) {
                        const glow = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size * 5);
                        glow.addColorStop(0, `rgba(255,220,100,${p.alpha * 0.9})`);
                        glow.addColorStop(0.3, `rgba(200,150,50,${p.alpha * 0.4})`);
                        glow.addColorStop(1, 'rgba(100,60,0,0)');
                        ctx.beginPath(); ctx.arc(p.x, p.y, p.size * 5, 0, Math.PI * 2);
                        ctx.fillStyle = glow; ctx.fill();
                    }

                    ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fillStyle = p.color; ctx.globalAlpha = p.alpha;
                    ctx.fill(); ctx.globalAlpha = 1;

                } else if (p.type === 'steam') {
                    p.x += p.vx; p.y += p.vy;
                    p.vx += (Math.random() - 0.5) * 0.02;
                    p.size += p.growRate;
                    p.alpha = p.maxAlpha * fadeIn * fadeOut;

                    const layers = isMobile ? 1 : 4;
                    for (let layer = layers - 1; layer >= 0; layer--) {
                        const lr = p.size * (0.4 + layer * 0.25);
                        const la = p.alpha * (1 - layer * 0.22);
                        const sg = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, lr);
                        sg.addColorStop(0, `${p.color},${la})`);
                        sg.addColorStop(0.5, `${p.color},${la * 0.5})`);
                        sg.addColorStop(1, `${p.color},0)`);
                        ctx.beginPath(); ctx.arc(p.x, p.y, lr, 0, Math.PI * 2);
                        ctx.fillStyle = sg; ctx.fill();
                    }
                }

                if (p.life >= p.maxLife) {
                    if (p.type === 'ember') emberCount--;
                    else steamCount--;
                    particles.splice(i, 1);
                }
            }
        }

        function loop(ts) {
            if (ts - lastFrameTime < TARGET_MS) {
                requestAnimationFrame(loop);
                return;
            }
            lastFrameTime = ts;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            updateParticles(ts);
            requestAnimationFrame(loop);
        }
        requestAnimationFrame(loop);

        // â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const VIDEO_PAGES = new Set(['page-act1-video', 'page-act2-video']);
        let currentPage = 'page-home';

        function stopVideos() {
            // Pause YouTube iframes by posting a pause command via postMessage
            document.querySelectorAll('iframe').forEach(iframe => {
                iframe.contentWindow.postMessage(
                    JSON.stringify({ event: 'command', func: 'pauseVideo', args: [] }),
                    '*'
                );
            });
        }

        function navigate(id, skipHistory = false) {
            stopVideos();
            document.querySelector(`#${currentPage}`).classList.remove('active');
            document.querySelector(`#${id}`).classList.add('active');
            currentPage = id;
            document.getElementById('backBtn').classList.toggle('visible', id !== 'page-home');
            canvas.classList.toggle('dimmed', VIDEO_PAGES.has(id));
            if (!skipHistory) history.pushState({ page: id }, '', '#' + id);

            // Mark act buttons as completed when returning home after finishing an act
            if (id === 'page-home') {
                if (completed.act1) document.getElementById('btn-act1').classList.add('completed');
                if (completed.act2) document.getElementById('btn-act2').classList.add('completed');
            }
        }

        window.addEventListener('popstate', e => navigate(e.state?.page || 'page-home', true));

        function goHome() {
            navigate('page-home');
            document.getElementById('act1-iframe').src = '';
            document.getElementById('act2-iframe').src = '';
        }

        // â”€â”€ ACT I â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function checkPassword() {
            const val = document.getElementById('pw-input').value;
            const err = document.getElementById('pw-error');
            if (val.trim().toLowerCase() === PASSWORD.toLowerCase()) {
                err.classList.remove('show');
                document.getElementById('act1-iframe').src = ACT1_VIDEO;
                navigate('page-act1-video');
                unlockAct2(); // Unlock Act II upon completing Act I
            } else {
                err.classList.add('show');
                setTimeout(() => err.classList.remove('show'), 2500);
            }
        }

        // â”€â”€ ACT II â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function checkQ1() {
            const val = parseInt(document.getElementById('q1-input').value, 10);
            const err = document.getElementById('q1-error');
            if (val === 19) { err.classList.remove('show'); navigate('page-act2-q2'); }
            else { err.classList.add('show'); setTimeout(() => err.classList.remove('show'), 2500); }
        }

        function updateBudgetTotal() {
            const f = parseFloat(document.getElementById('b-fixed').value) || 0;
            const s = parseFloat(document.getElementById('b-savings').value) || 0;
            const l = parseFloat(document.getElementById('b-leisure').value) || 0;
            const total = f + s + l;
            const el = document.getElementById('budget-total');
            if (Math.round(total) === 100) {
                if (l >= 20) {
                    el.textContent = `Total: ${total}% âœ“  â€”  ${l}% on leisureâ€¦ perhaps that could shrink a little?`;
                    el.className = 'budget-total leisure-warning';
                } else {
                    el.textContent = `Total: ${total}% âœ“`;
                    el.className = 'budget-total valid';
                }
            } else {
                el.textContent = `Total: ${total}%`;
                el.className = 'budget-total invalid';
            }
        }

        function checkQ2() {
            const f = parseFloat(document.getElementById('b-fixed').value) || 0;
            const s = parseFloat(document.getElementById('b-savings').value) || 0;
            const l = parseFloat(document.getElementById('b-leisure').value) || 0;
            const err = document.getElementById('q2-error');
            if (Math.round(f + s + l) === 100) { err.classList.remove('show'); navigate('page-act2-q3'); }
            else { err.classList.add('show'); setTimeout(() => err.classList.remove('show'), 2500); }
        }

        function checkQ3() {
            const val = document.getElementById('q3-input').value.trim().toLowerCase();
            const err = document.getElementById('q3-error');
            if (val === 'vegetables' || val === 'vegetable') { err.classList.remove('show'); navigate('page-act2-q4'); }
            else { err.classList.add('show'); setTimeout(() => err.classList.remove('show'), 2500); }
        }

        function checkQ4() {
            const val = document.getElementById('q4-input').value.trim().toLowerCase();
            const err = document.getElementById('q4-error');
            if (val === 'support') {
                err.classList.remove('show');
                document.getElementById('act2-iframe').src = ACT2_VIDEO;
                navigate('page-act2-video');
                unlockAct3(); // Unlock Act III upon completing Act II
            } else { err.classList.add('show'); setTimeout(() => err.classList.remove('show'), 2500); }
        }

        // â”€â”€ ACT III â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function checkQ5() {
            const val = document.getElementById('q5-input').value.trim();
            const err = document.getElementById('q5-error');
            if (val.length > 0 && val.toLowerCase() === "carrot") { err.classList.remove('show'); navigate('page-act3-finale'); }
            else { err.classList.add('show'); setTimeout(() => err.classList.remove('show'), 2500); }
        }

        // â”€â”€ TRANSCRIPTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const transcriptOpen = {};

        function toggleTranscript(id) {
            const body = document.getElementById(`${id}-body`);
            const icon = document.getElementById(`${id}-icon`);
            transcriptOpen[id] = !transcriptOpen[id];
            body.classList.toggle('open', transcriptOpen[id]);
            icon.textContent = transcriptOpen[id] ? 'â–´' : 'â–¾';
        }

        function setLang(transcriptId, lang, btn) {
            const wrap = document.getElementById(`${transcriptId}-body`);
            wrap.querySelectorAll('.transcript-text').forEach(el => el.classList.remove('active'));
            wrap.querySelectorAll('.lang-tab').forEach(el => el.classList.remove('active'));
            document.getElementById(`${transcriptId}-${lang}`).classList.add('active');
            btn.classList.add('active');
        }
    </script>
</body>

</html>